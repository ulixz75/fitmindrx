<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba de Pestañas</title>
    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCJ-BrvmefrufkAqMB2yAH0iN-CI8BTJmQ",
            authDomain: "members-access.firebaseapp.com",
            projectId: "members-access",
            storageBucket: "members-access.firebasestorage.app",
            messagingSenderId: "136940576302",
            appId: "1:136940576302:web:da0f24f538341bac8e49bf"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
    </script>
    <style>
        /* Estilos existentes */
        .tab {
            display: inline-block;
            padding: 10px 20px;
            margin: 0 5px;
            cursor: pointer;
            background-color: #f1f1f1;
            border: 1px solid #ccc;
        }

        .tab.active {
            background-color: #ddd;
        }

        .tab-content {
            display: none;
            padding: 20px;
            border-top: 1px solid #ccc;
        }

        .tab-content.active {
            display: block;
        }

        /* Nuevos estilos para el login */
        #loginForm {
            max-width: 300px;
            margin: 50px auto;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 15px;
        }

        input {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            padding: 10px 20px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background: #1976D2;
        }

        #mainContent {
            display: none;
            padding: 20px;
        }

        #logoutBtn {
            position: fixed;
            top: 20px;
            right: 20px;
        }
    </style>
</head>
<body>
    <!-- Login Form -->
    <div id="loginForm">
        <h2 style="margin-bottom: 20px;">Login</h2>
        <div class="form-group">
            <input type="email" id="userEmail" placeholder="Email" required>
        </div>
        <div class="form-group">
            <input type="password" id="userPassword" placeholder="Password" required>
        </div>
        <button onclick="login()">Login</button>
    </div>

    <!-- Main Content (initially hidden) -->
    <div id="mainContent">
        <button id="logoutBtn" onclick="logout()">Logout</button>
        <h2>Prueba de Pestañas</h2>

        <div class="tabs" id="tabButtons">
            <!-- Tabs will be generated here based on user permissions -->
        </div>

        <div id="tab1" class="tab-content">
            <h3>Contenido de Tab 1</h3>
            <p>Este es el contenido de la primera pestaña.</p>
        </div>

        <div id="tab2" class="tab-content">
            <h3>Contenido de Tab 2</h3>
            <p>Este es el contenido de la segunda pestaña.</p>
        </div>

        <div id="tab3" class="tab-content">
            <h3>Contenido de Tab 3</h3>
            <p>Este es el contenido de la tercera pestaña.</p>
        </div>

        <div id="tab4" class="tab-content">
            <h3>Contenido de Tab 4</h3>
            <p>Este es el contenido de la cuarta pestaña.</p>
        </div>
    </div>

    <script>
        // Login function
        async function login() {
            const email = document.getElementById('userEmail').value;
            const password = document.getElementById('userPassword').value;

            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Logout function
        async function logout() {
            try {
                await auth.signOut();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Function to generate tabs based on user permissions
        async function generateUserTabs(email) {
            const userDoc = await db.collection('users').doc(email).get();
            if (!userDoc.exists) {
                alert('User not found');
                return;
            }

            const userData = userDoc.data();
            const tabButtons = document.getElementById('tabButtons');
            tabButtons.innerHTML = ''; // Clear existing tabs

            // Generate only the tabs the user has access to
            if (userData.tabAccess.tab1) {
                tabButtons.innerHTML += `<div class="tab" onclick="openTab(event, 'tab1')">Tab 1</div>`;
            }
            if (userData.tabAccess.tab2) {
                tabButtons.innerHTML += `<div class="tab" onclick="openTab(event, 'tab2')">Tab 2</div>`;
            }
            if (userData.tabAccess.tab3) {
                tabButtons.innerHTML += `<div class="tab" onclick="openTab(event, 'tab3')">Tab 3</div>`;
            }
            if (userData.tabAccess.tab4) {
                tabButtons.innerHTML += `<div class="tab" onclick="openTab(event, 'tab4')">Tab 4</div>`;
            }

            // Activate first tab
            const firstTab = document.querySelector('.tab');
            if (firstTab) {
                firstTab.click();
            }
        }

        // Tab switching function
        function openTab(event, tabId) {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));

            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));

            event.currentTarget.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        // Auth state observer
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                // User is signed in
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                await generateUserTabs(user.email);
            } else {
                // User is signed out
                document.getElementById('loginForm').style.display = 'block';
                document.getElementById('mainContent').style.display = 'none';
            }
        });
    </script>
</body>
</html>
